{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState, useEffect, useContext } from 'react';\nimport supabase from \"../utils/supabaseClient\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext();\nexport function useAuth() {\n  return useContext(AuthContext);\n}\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    session = _useState4[0],\n    setSession = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    userDetails = _useState8[0],\n    setUserDetails = _useState8[1];\n  useEffect(function () {\n    checkUser();\n    var _supabase$auth$onAuth = supabase.auth.onAuthStateChange(function () {\n        var _ref2 = _asyncToGenerator(function* (event, newSession) {\n          setSession(newSession);\n          setUser((newSession == null ? void 0 : newSession.user) || null);\n          setLoading(false);\n          if (newSession != null && newSession.user) {\n            fetchUserDetails(newSession.user.id);\n          }\n        });\n        return function (_x, _x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }()),\n      authListener = _supabase$auth$onAuth.data;\n    return function () {\n      if (authListener != null && authListener.unsubscribe) {\n        authListener.unsubscribe();\n      }\n    };\n  }, []);\n  var checkUser = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      try {\n        var _data$session, _data$session2;\n        var _yield$supabase$auth$ = yield supabase.auth.getSession(),\n          data = _yield$supabase$auth$.data;\n        setSession(data.session);\n        setUser(((_data$session = data.session) == null ? void 0 : _data$session.user) || null);\n        if ((_data$session2 = data.session) != null && _data$session2.user) {\n          fetchUserDetails(data.session.user.id);\n        }\n        setLoading(false);\n      } catch (error) {\n        console.error('Error checking user:', error);\n        setLoading(false);\n      }\n    });\n    return function checkUser() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var fetchUserDetails = function () {\n    var _ref4 = _asyncToGenerator(function* (userId) {\n      try {\n        var _yield$supabase$from$ = yield supabase.from('profiles').select('*').eq('id', userId).single(),\n          data = _yield$supabase$from$.data,\n          error = _yield$supabase$from$.error;\n        if (error) throw error;\n        setUserDetails(data);\n      } catch (error) {\n        console.error('Error fetching user details:', error);\n      }\n    });\n    return function fetchUserDetails(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var signUp = function () {\n    var _ref5 = _asyncToGenerator(function* (email, password, username) {\n      try {\n        setLoading(true);\n        var _yield$supabase$auth$2 = yield supabase.auth.signUp({\n            email: email,\n            password: password\n          }),\n          data = _yield$supabase$auth$2.data,\n          error = _yield$supabase$auth$2.error;\n        if (error) throw error;\n        if (data.user) {\n          var _yield$supabase$from$2 = yield supabase.from('profiles').insert([{\n              id: data.user.id,\n              username: username,\n              email: email,\n              created_at: new Date()\n            }]),\n            profileError = _yield$supabase$from$2.error;\n          if (profileError) throw profileError;\n        }\n        return {\n          data: data,\n          error: null\n        };\n      } catch (error) {\n        Alert.alert('Error signing up', error.message);\n        return {\n          data: null,\n          error: error\n        };\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function signUp(_x4, _x5, _x6) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var signIn = function () {\n    var _ref6 = _asyncToGenerator(function* (email, password) {\n      try {\n        setLoading(true);\n        var _yield$supabase$auth$3 = yield supabase.auth.signInWithPassword({\n            email: email,\n            password: password\n          }),\n          data = _yield$supabase$auth$3.data,\n          error = _yield$supabase$auth$3.error;\n        if (error) throw error;\n        return {\n          data: data,\n          error: null\n        };\n      } catch (error) {\n        Alert.alert('Error signing in', error.message);\n        return {\n          data: null,\n          error: error\n        };\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function signIn(_x7, _x8) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var signOut = function () {\n    var _ref7 = _asyncToGenerator(function* () {\n      try {\n        setLoading(true);\n        var _yield$supabase$auth$4 = yield supabase.auth.signOut(),\n          error = _yield$supabase$auth$4.error;\n        if (error) throw error;\n        setUser(null);\n        setSession(null);\n        setUserDetails(null);\n      } catch (error) {\n        Alert.alert('Error signing out', error.message);\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function signOut() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var value = {\n    user: user,\n    session: session,\n    userDetails: userDetails,\n    loading: loading,\n    signUp: signUp,\n    signIn: signIn,\n    signOut: signOut\n  };\n  return _jsx(AuthContext.Provider, {\n    value: value,\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","supabase","Alert","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","session","setSession","_useState5","_useState6","loading","setLoading","_useState7","_useState8","userDetails","setUserDetails","checkUser","_supabase$auth$onAuth","auth","onAuthStateChange","_ref2","_asyncToGenerator","event","newSession","fetchUserDetails","id","_x","_x2","apply","arguments","authListener","data","unsubscribe","_ref3","_data$session","_data$session2","_yield$supabase$auth$","getSession","error","console","_ref4","userId","_yield$supabase$from$","from","select","eq","single","_x3","signUp","_ref5","email","password","username","_yield$supabase$auth$2","_yield$supabase$from$2","insert","created_at","Date","profileError","alert","message","_x4","_x5","_x6","signIn","_ref6","_yield$supabase$auth$3","signInWithPassword","_x7","_x8","signOut","_ref7","_yield$supabase$auth$4","value","Provider"],"sources":["/home/runner/workspace/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\nimport supabase from '../utils/supabaseClient';\nimport { Alert } from 'react-native';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [session, setSession] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [userDetails, setUserDetails] = useState(null);\n\n  useEffect(() => {\n    // Check for active session on init\n    checkUser();\n\n    // Set up listener for auth state changes\n    const { data: authListener } = supabase.auth.onAuthStateChange(\n      async (event, newSession) => {\n        setSession(newSession);\n        setUser(newSession?.user || null);\n        setLoading(false);\n\n        if (newSession?.user) {\n          fetchUserDetails(newSession.user.id);\n        }\n      }\n    );\n\n    return () => {\n      if (authListener?.unsubscribe) {\n        authListener.unsubscribe();\n      }\n    };\n  }, []);\n\n  const checkUser = async () => {\n    try {\n      const { data } = await supabase.auth.getSession();\n      setSession(data.session);\n      setUser(data.session?.user || null);\n      \n      if (data.session?.user) {\n        fetchUserDetails(data.session.user.id);\n      }\n      \n      setLoading(false);\n    } catch (error) {\n      console.error('Error checking user:', error);\n      setLoading(false);\n    }\n  };\n\n  const fetchUserDetails = async (userId) => {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n\n      if (error) throw error;\n      setUserDetails(data);\n    } catch (error) {\n      console.error('Error fetching user details:', error);\n    }\n  };\n\n  const signUp = async (email, password, username) => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n      });\n\n      if (error) throw error;\n\n      // Create a profile for the user\n      if (data.user) {\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .insert([\n            {\n              id: data.user.id,\n              username,\n              email,\n              created_at: new Date(),\n            },\n          ]);\n\n        if (profileError) throw profileError;\n      }\n\n      return { data, error: null };\n    } catch (error) {\n      Alert.alert('Error signing up', error.message);\n      return { data: null, error };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signIn = async (email, password) => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      if (error) throw error;\n      return { data, error: null };\n    } catch (error) {\n      Alert.alert('Error signing in', error.message);\n      return { data: null, error };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      setLoading(true);\n      const { error } = await supabase.auth.signOut();\n      if (error) throw error;\n      setUser(null);\n      setSession(null);\n      setUserDetails(null);\n    } catch (error) {\n      Alert.alert('Error signing out', error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const value = {\n    user,\n    session,\n    userDetails,\n    loading,\n    signUp,\n    signIn,\n    signOut,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}