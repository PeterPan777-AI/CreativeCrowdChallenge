<!DOCTYPE html>
<html>
<head>
  <title>CreativeCrowdChallenge - Web App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="A platform for creative challenges and competitions">
  <meta name="theme-color" content="#3b82f6">
  <link rel="manifest" href="/manifest.json">
  
  <!-- iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CreativeCC">
  <link rel="apple-touch-icon" href="/assets/icon-192x192.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/assets/icon-192x192.png">
  
  <style>
    /* Base styles */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #333;
    }
    
    /* Header */
    header {
      background-color: #3B82F6;
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    
    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Card styles */
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    /* Button styles */
    button {
      background-color: #3B82F6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #2563EB;
    }

    button.secondary {
      background-color: #6B7280;
    }

    button.secondary:hover {
      background-color: #4B5563;
    }

    button.success {
      background-color: #10B981;
    }

    button.success:hover {
      background-color: #059669;
    }
    
    /* Tab navigation */
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
      overflow-x: auto;
      white-space: nowrap;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      margin-right: 5px;
    }
    
    .tab.active {
      border-bottom: 3px solid #3B82F6;
      color: #3B82F6;
      font-weight: bold;
    }
    
    /* Screens */
    .screen {
      display: none;
    }
    
    .screen.active {
      display: block;
    }

    /* Form styles */
    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    textarea {
      min-height: 100px;
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 50px;
      font-size: 12px;
      background-color: #E5E7EB;
      margin-right: 5px;
    }

    .badge.primary {
      background-color: #DBEAFE;
      color: #1E40AF;
    }
    
    /* Social sharing styles */
    .share-buttons {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }
    
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #f5f5f5;
      cursor: pointer;
      transition: background-color 0.3s;
      border: none;
      font-size: 18px;
    }
    
    .share-button:hover {
      background-color: #e0e0e0;
    }
    
    .share-button.twitter {
      background-color: #1DA1F2;
      color: white;
    }
    
    .share-button.facebook {
      background-color: #4267B2;
      color: white;
    }
    
    .share-button.linkedin {
      background-color: #0077B5;
      color: white;
    }
    
    .share-button.email {
      background-color: #D44638;
      color: white;
    }
    
    .share-button.clipboard {
      background-color: #6e6e6e;
      color: white;
    }

    .badge.success {
      background-color: #D1FAE5;
      color: #065F46;
    }

    /* Rating stars */
    .rating {
      display: flex;
      margin: 10px 0;
    }

    .star {
      color: #D1D5DB;
      font-size: 24px;
      cursor: pointer;
    }

    .star.filled {
      color: #F59E0B;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6B7280;
      padding: 0;
    }

    /* Notification container */
    #notification-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column-reverse;
      gap: 10px;
      max-width: 300px;
    }
    
    /* Notification styling */
    .notification {
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      position: relative;
      animation: slide-in 0.3s ease-out forwards;
      opacity: 0;
      transform: translateX(30px);
      margin-bottom: 8px;
      overflow: hidden;
      font-size: 15px;
      line-height: 1.5;
      display: none;
    }
    
    /* Notification types */
    .notification.success {
      background-color: #10B981;
    }
    
    .notification.error {
      background-color: #EF4444;
    }
    
    .notification.info {
      background-color: #3B82F6;
    }
    
    .notification.warning {
      background-color: #F59E0B;
    }
    
    /* Animations */
    @keyframes slide-in {
      0% {
        opacity: 0;
        transform: translateX(30px);
      }
      100% {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes slide-out {
      0% {
        opacity: 1;
        transform: translateX(0);
      }
      100% {
        opacity: 0;
        transform: translateX(30px);
      }
    }
    
    @keyframes slide-in {
      0% { transform: translateX(100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slide-out {
      0% { transform: translateX(0); opacity: 1; }
      100% { transform: translateX(100%); opacity: 0; }
    }

    /* Profile header */
    .profile-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #3B82F6;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      margin-right: 20px;
    }

    .profile-info {
      flex: 1;
    }

    /* Competition details */
    .competition-header {
      position: relative;
      padding-bottom: 10px;
      border-bottom: 1px solid #E5E7EB;
      margin-bottom: 15px;
    }

    .competition-meta {
      display: flex;
      margin-bottom: 10px;
    }

    .meta-item {
      margin-right: 20px;
      font-size: 14px;
      color: #6B7280;
    }

    /* Stats */
    .stats-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .stat-box {
      flex: 1;
      min-width: 100px;
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      margin: 0 5px 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #3B82F6;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #6B7280;
    }

    /* Back button */
    .back-button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      position: absolute;
      left: 20px;
      top: 20px;
    }

    .back-icon {
      margin-right: 5px;
    }

    /* Tab content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Login form */
    .auth-options {
      display: flex;
      margin-bottom: 20px;
    }

    .auth-option {
      flex: 1;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      border-bottom: 2px solid #E5E7EB;
    }

    .auth-option.active {
      border-bottom: 2px solid #3B82F6;
      color: #3B82F6;
      font-weight: bold;
    }

    /* Analytics styles */
    .chart-container {
      position: relative;
      margin: 20px 0;
      height: 300px;
    }
    
    .analytics-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    .analytics-table th, 
    .analytics-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #E5E7EB;
    }
    
    .analytics-table th {
      background-color: #F9FAFB;
      font-weight: 600;
    }
    
    .analytics-table tr:hover {
      background-color: #F9FAFB;
    }
    
    .metric-card {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .metric-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #EBF5FF;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 20px;
      color: #3B82F6;
    }
    
    .metric-info {
      flex: 1;
    }
    
    .metric-label {
      font-size: 14px;
      color: #6B7280;
      margin-bottom: 5px;
    }
    
    .metric-value {
      font-size: 20px;
      font-weight: bold;
    }
    
    .trend-up {
      color: #10B981;
    }
    
    .trend-down {
      color: #EF4444;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .card {
        padding: 15px;
      }
      
      .tabs {
        padding: 0 10px;
      }
      
      .stat-box {
        min-width: calc(50% - 20px);
        margin-bottom: 10px;
      }
      
      .chart-container {
        height: 250px;
      }
      
      .analytics-table {
        font-size: 14px;
      }
      
      .analytics-table th, 
      .analytics-table td {
        padding: 8px;
      }
    }
    
    /* Submission styles */
    .submission-item {
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .submission-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .submission-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .submission-header h4 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }
    
    .submission-date {
      font-size: 14px;
      color: #666;
    }
    
    .submission-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }
    
    .votes-container {
      display: flex;
      align-items: center;
    }
    
    .votes-count {
      font-size: 18px;
      font-weight: bold;
      color: #3B82F6;
      margin-right: 5px;
      transition: transform 0.3s, color 0.3s;
    }
    
    .votes-label {
      font-size: 14px;
      color: #666;
    }
    
    .vote-button {
      background-color: #10B981;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background-color 0.2s;
    }
    
    .vote-button:hover {
      background-color: #059669;
    }
    
    .vote-button.disabled {
      background-color: #9CA3AF;
      cursor: not-allowed;
    }
    
    .vote-icon {
      margin-right: 5px;
    }
    
    .vote-added {
      transform: scale(1.2);
      color: #10B981;
      animation: pulse 0.5s;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1.2); }
    }
  </style>
</head>
<body>
  <header id="main-header">
    <h1>CreativeCrowdChallenge</h1>
    <p>Connect with creative competitions</p>
    <div id="offline-notification" style="display: none; background-color: #ffe66d; color: #333; padding: 8px; text-align: center; font-weight: bold; margin-top: 10px;">
      You are currently offline. Some features may be limited.
    </div>
    <!-- Add to Home Screen Prompt -->
    <div id="install-prompt" style="display: none; background-color: #e6f7ff; color: #333; padding: 10px; text-align: center; font-weight: bold; margin-top: 10px; border-radius: 5px;">
      <p style="margin: 0 0 8px 0;">üì± Add this app to your home screen for a better experience!</p>
      <div>
        <button id="install-button" class="primary" style="margin-right: 10px;">Install App</button>
        <button id="dismiss-install" class="secondary">Later</button>
      </div>
    </div>
  </header>
  
  <div class="container">
    
    <!-- Tab Navigation -->
    <div class="tabs">
      <div class="tab active" data-screen="home">Home</div>
      <div class="tab" data-screen="competitions">Competitions</div>
      <div class="tab" data-screen="submit">Submit</div>
      <div class="tab" data-screen="profile">Profile</div>
    </div>
    
    <!-- Home Screen -->
    <div id="home-screen" class="screen active">
      <div class="card">
        <h2>Welcome to CreativeCrowdChallenge!</h2>
        <p>Join exciting creative competitions and showcase your talents.</p>
        <button onclick="showScreen('competitions')">Explore Competitions</button>
      </div>
      
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-value">15</div>
          <div class="stat-label">Active Competitions</div>
        </div>
        <div class="stat-box">
          <div class="stat-value">256</div>
          <div class="stat-label">Participants</div>
        </div>
        <div class="stat-box">
          <div class="stat-value">42</div>
          <div class="stat-label">Winners Crowned</div>
        </div>
      </div>
      
      <div class="card">
        <h3>Popular Categories</h3>
        <div style="margin: 15px 0;">
          <span class="badge primary">Photography</span>
          <span class="badge primary">Digital Art</span>
          <span class="badge primary">Writing</span>
          <span class="badge primary">Music</span>
          <span class="badge primary">Video</span>
          <span class="badge primary">Graphic Design</span>
        </div>
        <button onclick="showCategorySuggestionModal()" class="secondary">Suggest a Category</button>
      </div>
    </div>
    
    <!-- Competitions Screen -->
    <div id="competitions-screen" class="screen">
      <div class="card">
        <h2>Active Competitions</h2>
        <div id="competitions-list">
          <div class="card">
            <h3>Summer Photography Contest</h3>
            <div class="competition-meta">
              <div class="meta-item"><strong>Ends:</strong> Apr 15, 2025</div>
              <div class="meta-item"><strong>Entries:</strong> 24</div>
            </div>
            <p>Show your best summer shots and win prizes!</p>
            <div>
              <span class="badge primary">Photography</span>
              <span class="badge success">Cash Prize</span>
            </div>
            <div style="margin-top: 15px;">
              <button onclick="showCompetitionDetails('photo-contest')">View Details</button>
            </div>
          </div>
          <div class="card">
            <h3>Creative Writing Challenge</h3>
            <div class="competition-meta">
              <div class="meta-item"><strong>Ends:</strong> Apr 30, 2025</div>
              <div class="meta-item"><strong>Entries:</strong> 18</div>
            </div>
            <p>Write a short story on the theme "New Beginnings"</p>
            <div>
              <span class="badge primary">Writing</span>
              <span class="badge success">Featured Publication</span>
            </div>
            <div style="margin-top: 15px;">
              <button onclick="showCompetitionDetails('writing-challenge')">View Details</button>
            </div>
          </div>
          <div class="card">
            <h3>Melody Makers Music Competition</h3>
            <div class="competition-meta">
              <div class="meta-item"><strong>Ends:</strong> May 10, 2025</div>
              <div class="meta-item"><strong>Entries:</strong> 7</div>
            </div>
            <p>Compose an original 2-minute piece in any genre</p>
            <div>
              <span class="badge primary">Music</span>
              <span class="badge success">Studio Time</span>
            </div>
            <div style="margin-top: 15px;">
              <button onclick="showCompetitionDetails('music-competition')">View Details</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Submit Screen -->
    <div id="submit-screen" class="screen">
      <div class="card">
        <h2>Submit Your Entry</h2>
        <p>Select a competition and submit your creative work.</p>
        
        <form id="submission-form">
          <div class="form-group">
            <label for="competition-select">Select Competition</label>
            <select id="competition-select" required>
              <option value="">-- Select a competition --</option>
              <option value="photo-contest">Summer Photography Contest</option>
              <option value="writing-challenge">Creative Writing Challenge</option>
              <option value="music-competition">Melody Makers Music Competition</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="submission-title">Title of Your Work</label>
            <input type="text" id="submission-title" placeholder="Give your submission a title" required>
          </div>
          
          <div class="form-group">
            <label for="submission-description">Description</label>
            <textarea id="submission-description" placeholder="Tell us about your work..." required></textarea>
          </div>
          
          <div class="form-group">
            <label for="submission-file">Upload Your Work</label>
            <input type="file" id="submission-file">
            <p style="font-size: 14px; color: #6B7280; margin-top: 5px;">Max file size: 10MB. Supported formats depend on the competition category.</p>
          </div>
          
          <div class="form-group">
            <button type="button" onclick="submitEntry()" class="success">Submit Entry</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Profile Screen -->
    <div id="profile-screen" class="screen">
      <div id="profile-logged-out">
        <div class="card">
          <h2>Login or Register</h2>
          
          <div class="auth-options">
            <div class="auth-option active" onclick="showAuthTab('login')">Login</div>
            <div class="auth-option" onclick="showAuthTab('register')">Register</div>
          </div>
          
          <div id="login-tab" class="tab-content active">
            <form id="login-form">
              <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="your@email.com" required>
              </div>
              <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" placeholder="Your password" required>
              </div>
              <div class="form-group">
                <button type="button" onclick="login()">Login</button>
              </div>
            </form>
          </div>
          
          <div id="register-tab" class="tab-content">
            <form id="register-form">
              <div class="form-group">
                <label for="register-name">Full Name</label>
                <input type="text" id="register-name" placeholder="Your name" required>
              </div>
              <div class="form-group">
                <label for="register-email">Email</label>
                <input type="email" id="register-email" placeholder="your@email.com" required>
              </div>
              <div class="form-group">
                <label for="register-password">Password</label>
                <input type="password" id="register-password" placeholder="Choose a password" required>
              </div>
              <div class="form-group">
                <button type="button" onclick="register()">Register</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <div id="profile-logged-in" style="display: none;">
        <div class="profile-header">
          <div class="profile-avatar">DU</div>
          <div class="profile-info">
            <h2 id="profile-user-name">Demo User</h2>
            <p id="profile-member-since">Member since March 2023</p>
            <p id="profile-user-role" style="font-style: italic; color: #6B7280;">Regular User</p>
          </div>
        </div>
        
        <div class="stats-container">
          <div class="stat-box">
            <div class="stat-value" id="profile-submissions">5</div>
            <div class="stat-label">Submissions</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="profile-awards">2</div>
            <div class="stat-label">Awards</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="profile-votes">12</div>
            <div class="stat-label">Votes Cast</div>
          </div>
        </div>
        
        <!-- Back Office section for admin and business users -->
        <div id="back-office-section" class="card" style="display: none; margin-bottom: 20px; background-color: #F8FAFC; border-left: 4px solid #3B82F6;">
          <h3 style="color: #1E40AF;">Back Office</h3>
          <p>Access special features for businesses and administrators.</p>
          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button onclick="showAnalyticsDashboard()" style="background-color: #1E40AF;">Analytics Dashboard</button>
          </div>
        </div>
        
        <div class="card">
          <h3>My Submissions</h3>
          <div class="card">
            <h4>Sunset at the Beach</h4>
            <div class="competition-meta">
              <div class="meta-item"><strong>Competition:</strong> Summer Photography Contest</div>
              <div class="meta-item"><strong>Status:</strong> Under Review</div>
            </div>
            <div class="share-buttons">
              <button class="share-button twitter" title="Share on Twitter" onclick="shareContent('twitter', 'Sunset at the Beach', 'Check out my submission to the Summer Photography Contest')">
                T
              </button>
              <button class="share-button facebook" title="Share on Facebook" onclick="shareContent('facebook', 'Sunset at the Beach', 'My submission to the Summer Photography Contest')">
                f
              </button>
              <button class="share-button linkedin" title="Share on LinkedIn" onclick="shareContent('linkedin', 'Sunset at the Beach', 'My photography submission')">
                in
              </button>
              <button class="share-button email" title="Share via Email" onclick="shareContent('email', 'My Photography Submission', 'Check out my submission to the Summer Photography Contest')">
                ‚úâ
              </button>
              <button class="share-button clipboard" title="Copy Link" onclick="shareContent('clipboard', 'Sunset at the Beach', 'My summer photography submission')">
                üìã
              </button>
            </div>
            <div style="margin-top: 15px;">
              <button onclick="alert('View submission details')">View Details</button>
            </div>
          </div>
          <div class="card">
            <h4>New Day Rising</h4>
            <div class="competition-meta">
              <div class="meta-item"><strong>Competition:</strong> Creative Writing Challenge</div>
              <div class="meta-item"><strong>Status:</strong> Runner-up</div>
            </div>
            <div class="share-buttons">
              <button class="share-button twitter" title="Share on Twitter" onclick="shareContent('twitter', 'New Day Rising', 'Read my submission to the Creative Writing Challenge!')">
                T
              </button>
              <button class="share-button facebook" title="Share on Facebook" onclick="shareContent('facebook', 'New Day Rising', 'My writing submission')">
                f
              </button>
              <button class="share-button linkedin" title="Share on LinkedIn" onclick="shareContent('linkedin', 'New Day Rising', 'My award-winning short story')">
                in
              </button>
              <button class="share-button email" title="Share via Email" onclick="shareContent('email', 'My Writing Submission', 'I wanted to share my Creative Writing Challenge entry with you')">
                ‚úâ
              </button>
              <button class="share-button clipboard" title="Copy Link" onclick="shareContent('clipboard', 'New Day Rising', 'My writing submission')">
                üìã
              </button>
            </div>
            <div style="margin-top: 15px;">
              <button onclick="alert('View submission details')">View Details</button>
            </div>
          </div>
        </div>
        

        
        <button onclick="logout()" class="secondary">Logout</button>
      </div>
    </div>
    
    <!-- Analytics Screen -->
    <div id="analytics-screen" class="screen">
      <div class="card">
        <h2>Business Analytics</h2>
        <p>Track engagement and performance for your competitions.</p>
        
        <div id="business-selector-container" class="form-group">
          <label for="business-selector">Select Business</label>
          <select id="business-selector" onchange="loadBusinessAnalytics()">
            <option value="mock-business-1">TechCreate Solutions</option>
            <option value="mock-business-2">EcoDesign Innovations</option>
          </select>
        </div>
      </div>
      
      <div class="stats-container">
        <div class="stat-box">
          <div class="stat-value" id="total-competitions">3</div>
          <div class="stat-label">Total Competitions</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="total-submissions">42</div>
          <div class="stat-label">Total Submissions</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="total-views">1.2k</div>
          <div class="stat-label">Total Views</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="avg-engagement">32%</div>
          <div class="stat-label">Avg. Engagement</div>
        </div>
      </div>
      
      <div class="card">
        <h3>Competition Performance</h3>
        <div id="competitions-chart" class="chart-container">
          <!-- Canvas will be created dynamically -->
        </div>
      </div>
      
      <div class="card">
        <h3>Demographic Breakdown</h3>
        <div id="demographics-chart" class="chart-container">
          <!-- Canvas will be created dynamically -->
        </div>
      </div>
      
      <div class="card">
        <h3>Submission Analytics</h3>
        <table class="analytics-table">
          <thead>
            <tr>
              <th>Competition</th>
              <th>Submissions</th>
              <th>Views</th>
              <th>Engagement Rate</th>
            </tr>
          </thead>
          <tbody id="analytics-table-body">
            <tr>
              <td>Logo Design Challenge</td>
              <td>24</td>
              <td>487</td>
              <td>4.9%</td>
            </tr>
            <tr>
              <td>Mobile App UI Challenge</td>
              <td>12</td>
              <td>295</td>
              <td>4.1%</td>
            </tr>
            <tr>
              <td>Marketing Campaign Concept</td>
              <td>6</td>
              <td>218</td>
              <td>2.8%</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="card">
        <h3>Engagement Timeline</h3>
        <div id="timeline-chart" class="chart-container">
          <!-- Canvas will be created dynamically -->
        </div>
      </div>
      
      <div class="card">
        <h3>Export Options</h3>
        <div style="display: flex; gap: 10px;">
          <button onclick="exportAnalytics('csv')" class="secondary">Export as CSV</button>
          <button onclick="exportAnalytics('pdf')" class="secondary">Export as PDF</button>
          <button onclick="exportAnalytics('json')" class="secondary">Export Raw Data</button>
        </div>
      </div>
    </div>
    
    <!-- Competition Details Screen (hidden by default) -->
    <div id="competition-details-screen" class="screen">
      <div class="card">
        <div class="competition-header">
          <h2 id="competition-title">Competition Title</h2>
          <div class="competition-meta">
            <div class="meta-item"><strong>Deadline:</strong> <span id="competition-deadline">April 15, 2025</span></div>
            <div class="meta-item"><strong>Entries:</strong> <span id="competition-entries">24</span></div>
          </div>
          <div id="competition-categories">
            <span class="badge primary">Category</span>
          </div>
        </div>
        
        <div id="competition-description">
          <p>Competition description will appear here.</p>
        </div>
        
        <h3>Prizes</h3>
        <ul id="competition-prizes">
          <li>First place: $100</li>
          <li>Runner-up: $50</li>
        </ul>
        
        <h3>Rules</h3>
        <ul id="competition-rules">
          <li>All submissions must be original work</li>
          <li>One submission per participant</li>
        </ul>
        
        <h3>Share This Competition</h3>
        <div class="share-buttons">
          <button class="share-button twitter" title="Share on Twitter" onclick="shareContent('twitter', 'Competition Title', 'Check out this creative competition')">
            T
          </button>
          <button class="share-button facebook" title="Share on Facebook" onclick="shareContent('facebook', 'Competition Title', 'Join this creative competition')">
            f
          </button>
          <button class="share-button linkedin" title="Share on LinkedIn" onclick="shareContent('linkedin', 'Competition Title', 'Participate in this competition')">
            in
          </button>
          <button class="share-button email" title="Share via Email" onclick="shareContent('email', 'Competition Title', 'I thought you might be interested in this competition')">
            ‚úâ
          </button>
          <button class="share-button clipboard" title="Copy Link" onclick="shareContent('clipboard', 'Competition Title', 'Check out this competition')">
            üìã
          </button>
        </div>
        
        <div style="margin-top: 20px; display: flex; gap: 10px;">
          <button onclick="showScreen('submit')">Submit Entry</button>
          <button onclick="showScreen('competitions')" class="secondary">Back to List</button>
        </div>
      </div>
      
      <div class="card">
        <h3>Top Submissions</h3>
        <div id="submissions-list">
          <p>Submissions will be displayed once the competition has ended.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  <div id="category-suggestion-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Suggest a Category</h3>
        <button class="close-modal" onclick="closeCategorySuggestionModal()">&times;</button>
      </div>
      <form id="category-suggestion-form">
        <div class="form-group">
          <label for="category-name">Category Name</label>
          <input type="text" id="category-name" placeholder="e.g., Animation" required>
        </div>
        <div class="form-group">
          <label for="category-description">Why should we add this category?</label>
          <textarea id="category-description" placeholder="Tell us about this creative category..." required></textarea>
        </div>
        <div class="form-group">
          <button type="button" onclick="submitCategorySuggestion()">Submit Suggestion</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Notification -->
  <!-- Notifications will be dynamically created -->
  
  <!-- Include Chart.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/assets/js/indexedDBHelper.js"></script>
  
  <script>
    // Global state
    let isLoggedIn = false;
    let currentUser = null;
    let authToken = null;
    let competitions = {}; // Will be populated from API
    
    // Tab functionality
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const screenName = this.getAttribute('data-screen') + '-screen';
        showScreen(screenName);
      });
    });
    
    // Function to show a specific screen
    function showScreen(screenName) {
      // Ensure screen name has proper suffix
      const fullScreenName = screenName.endsWith('-screen') ? screenName : screenName + '-screen';
      
      // Special case for competition details to add back button
      if (fullScreenName === 'competition-details-screen') {
        document.getElementById('main-header').innerHTML = `
          <button class="back-button" onclick="showScreen('competitions')">
            <span class="back-icon">‚Üê</span> Back
          </button>
          <h1>Competition Details</h1>
        `;
      } else {
        document.getElementById('main-header').innerHTML = `
          <h1>CreativeCrowdChallenge</h1>
          <p>Connect with creative competitions</p>
        `;
      }
    
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.style.display = 'none';
      });
      
      // Show the requested screen
      const screenElement = document.getElementById(fullScreenName);
      if (screenElement) {
        screenElement.style.display = 'block';
        console.log("Showing screen:", fullScreenName);
      } else {
        console.error("Screen not found:", fullScreenName);
      }
      
      // Update the active tab (except for competition details which isn't a tab)
      if (screenName !== 'competition-details-screen') {
        // Get base screen name without -screen suffix
        const baseScreenName = screenName.replace('-screen', '');
        document.querySelectorAll('.tab').forEach(tab => {
          if (tab.getAttribute('data-screen') === baseScreenName) {
            tab.classList.add('active');
          } else {
            tab.classList.remove('active');
          }
        });
      }
      
      // Special handling for profile screen
      if (screenName === 'profile-screen' || screenName === 'profile') {
        updateProfileView();
      }
      
      // Special handling for analytics screen
      if (screenName === 'analytics-screen' || screenName === 'analytics') {
        console.log('Initializing analytics dashboard on screen change');
        setTimeout(() => {
          initializeAnalytics();
        }, 100);
      }
      
      console.log('Showing screen:', screenName);
    }
    
    // This is a legacy function, replaced by the one below
    // function showCompetitionDetails(competitionId) { ... }
    
    // Auth tab functionality
    function showAuthTab(tabName) {
      document.querySelectorAll('.auth-option').forEach(tab => {
        if (tab.textContent.toLowerCase() === tabName) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.getElementById(tabName + '-tab').classList.add('active');
    }
    
    // Login function
    function login() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      if (!email || !password) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      
      // Show loading state
      const loginButton = document.querySelector('#login-form button');
      const originalButtonText = loginButton.textContent;
      loginButton.textContent = 'Logging in...';
      loginButton.disabled = true;
      
      // Call our API
      fetch('/api/auth/signin', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Login failed');
        }
        return response.json();
      })
      .then(data => {
        console.log('Login successful', data);
        isLoggedIn = true;
        
        // Extract user data
        let userName = 'User';
        if (data.user && data.user.user_metadata && data.user.user_metadata.full_name) {
          userName = data.user.user_metadata.full_name;
        }
        
        // Get user role (in a real app, this would come from server)
        // For demo, we'll use a simple rule based on email:
        const isAdmin = email.includes('admin');
        const isBusiness = email.includes('business') || email === 'demo@example.com';
        const userRole = isAdmin ? 'admin' : (isBusiness ? 'business' : 'user');
        
        currentUser = {
          name: userName,
          email: email,
          memberSince: 'March 2025',
          submissions: 5,
          awards: 2,
          votesCast: 12,
          role: userRole
        };
        
        // Save session to localStorage
        localStorage.setItem('user', JSON.stringify(currentUser));
        
        showNotification('Login successful!');
        updateProfileView();
      })
      .catch(error => {
        console.error('Error during login:', error);
        showNotification('Login failed: ' + error.message, 'error');
      })
      .finally(() => {
        // Reset button state
        loginButton.textContent = originalButtonText;
        loginButton.disabled = false;
      });
    }
    
    // Register function
    function register() {
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      
      if (!name || !email || !password) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      
      // Show loading state
      const registerButton = document.querySelector('#register-form button');
      const originalButtonText = registerButton.textContent;
      registerButton.textContent = 'Registering...';
      registerButton.disabled = true;
      
      // Call our API
      fetch('/api/auth/signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
          name, 
          email, 
          password 
        })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Registration failed');
        }
        return response.json();
      })
      .then(data => {
        console.log('Registration successful', data);
        isLoggedIn = true;
        
        // Determine user role based on email (for demo purposes)
        const isAdmin = email.includes('admin');
        const isBusiness = email.includes('business') || email === 'demo@example.com';
        const userRole = isAdmin ? 'admin' : (isBusiness ? 'business' : 'user');
        
        currentUser = {
          name: name,
          email: email,
          memberSince: 'March 2025',
          submissions: 0,
          awards: 0,
          votesCast: 0,
          role: userRole
        };
        
        // Save session to localStorage
        localStorage.setItem('user', JSON.stringify(currentUser));
        
        showNotification('Registration successful!');
        updateProfileView();
      })
      .catch(error => {
        console.error('Error during registration:', error);
        showNotification('Registration failed: ' + error.message, 'error');
      })
      .finally(() => {
        // Reset button state
        registerButton.textContent = originalButtonText;
        registerButton.disabled = false;
      });
    }
    
    // Logout function
    function logout() {
      isLoggedIn = false;
      currentUser = null;
      updateProfileView();
      showNotification('Logged out successfully');
    }
    
    // Update profile view based on auth state
    function updateProfileView() {
      if (isLoggedIn) {
        document.getElementById('profile-logged-out').style.display = 'none';
        document.getElementById('profile-logged-in').style.display = 'block';
        
        // Update profile display data
        if (currentUser) {
          // Update profile details
          const profileNameEl = document.getElementById('profile-user-name');
          const profileMemberSinceEl = document.getElementById('profile-member-since');
          const profileRoleEl = document.getElementById('profile-user-role');
          const profileSubmissionsEl = document.getElementById('profile-submissions');
          const profileAwardsEl = document.getElementById('profile-awards');
          const profileVotesEl = document.getElementById('profile-votes');
          
          if (profileNameEl) profileNameEl.textContent = currentUser.name || 'User';
          if (profileMemberSinceEl) profileMemberSinceEl.textContent = `Member since ${currentUser.memberSince || 'March 2025'}`;
          if (profileRoleEl) {
            // Format role name nicely
            let roleDisplay = 'Regular User';
            if (currentUser.role === 'admin') roleDisplay = 'Administrator';
            if (currentUser.role === 'business') roleDisplay = 'Business Account';
            
            profileRoleEl.textContent = roleDisplay;
          }
          
          if (profileSubmissionsEl) profileSubmissionsEl.textContent = currentUser.submissions || 0;
          if (profileAwardsEl) profileAwardsEl.textContent = currentUser.awards || 0;
          if (profileVotesEl) profileVotesEl.textContent = currentUser.votesCast || 0;
          
          // Set profile avatar initials
          const avatarEl = document.querySelector('.profile-avatar');
          if (avatarEl && currentUser.name) {
            // Extract initials from name
            const nameParts = currentUser.name.split(' ');
            let initials = nameParts[0][0]; // First letter of first name
            if (nameParts.length > 1) {
              initials += nameParts[nameParts.length - 1][0]; // First letter of last name
            }
            avatarEl.textContent = initials.toUpperCase();
          }
        }
        
        // Show or hide back office based on user role
        const backOfficeSection = document.getElementById('back-office-section');
        if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'business')) {
          backOfficeSection.style.display = 'block';
          console.log('Showing back office for user role:', currentUser.role);
        } else {
          backOfficeSection.style.display = 'none';
          console.log('Hiding back office for regular user');
        }
      } else {
        document.getElementById('profile-logged-out').style.display = 'block';
        document.getElementById('profile-logged-in').style.display = 'none';
        
        // Hide back office when logged out
        const backOfficeSection = document.getElementById('back-office-section');
        if (backOfficeSection) {
          backOfficeSection.style.display = 'none';
        }
      }
    }
    
    // Show category suggestion modal
    function showCategorySuggestionModal() {
      document.getElementById('category-suggestion-modal').style.display = 'flex';
    }
    
    // Close category suggestion modal
    function closeCategorySuggestionModal() {
      document.getElementById('category-suggestion-modal').style.display = 'none';
    }
    
    // Submit category suggestion
    function submitCategorySuggestion() {
      const categoryName = document.getElementById('category-name').value;
      const description = document.getElementById('category-description').value;
      
      if (!categoryName || !description) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      
      // Show loading state
      const submitButton = document.querySelector('#category-form button');
      const originalButtonText = submitButton.textContent;
      submitButton.textContent = 'Submitting...';
      submitButton.disabled = true;
      
      // Call our API
      fetch('/api/category/suggest', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: categoryName,
          description: description
        })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to submit category suggestion');
        }
        return response.json();
      })
      .then(data => {
        console.log('Category suggestion submitted:', data);
        showNotification('Category suggestion submitted successfully!');
        closeCategorySuggestionModal();
        
        // Reset form
        document.getElementById('category-name').value = '';
        document.getElementById('category-description').value = '';
      })
      .catch(error => {
        console.error('Error submitting category:', error);
        showNotification('Failed to submit category: ' + error.message, 'error');
      })
      .finally(() => {
        // Reset button state
        submitButton.textContent = originalButtonText;
        submitButton.disabled = false;
      });
    }
    
    // Submit entry
    function submitEntry() {
      const competitionId = document.getElementById('competition-select').value;
      const title = document.getElementById('submission-title').value;
      const description = document.getElementById('submission-description').value;
      const file = document.getElementById('submission-file').files[0];
      
      if (!competitionId || !title || !description) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      if (!isLoggedIn) {
        showNotification('Please log in to submit your entry', 'error');
        showScreen('profile');
        return;
      }
      
      // Show loading state
      const submitButton = document.querySelector('#submission-form button');
      const originalButtonText = submitButton.textContent;
      submitButton.textContent = 'Submitting...';
      submitButton.disabled = true;
      
      // Create submission data object
      const submissionData = {
        competitionId: competitionId,
        title: title,
        description: description,
        userId: currentUser?.id || 'anonymous',
        timestamp: new Date().toISOString()
      };
      
      // Check if we're online
      if (navigator.onLine) {
        // We're online - send submission to API
        sendSubmissionToServer(submissionData, file, submitButton, originalButtonText);
      } else {
        // We're offline - save submission for later sync
        saveSubmissionForOfflineSync(submissionData, file, submitButton, originalButtonText);
      }
    }
    
    // Function to send submission to server
    function sendSubmissionToServer(submissionData, file, submitButton, originalButtonText) {
      fetch('/api/submission', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(submissionData)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to submit entry');
        }
        return response.json();
      })
      .then(data => {
        console.log('Entry submitted successfully:', data);
        showNotification('Entry submitted successfully!');
        
        // Reset form
        resetSubmissionForm();
      })
      .catch(error => {
        console.error('Error submitting entry:', error);
        
        // If there's a network error, save for offline sync
        if (!navigator.onLine || error.message.includes('network')) {
          saveSubmissionForOfflineSync(submissionData, file, submitButton, originalButtonText);
        } else {
          showNotification('Failed to submit entry: ' + error.message, 'error');
          
          // Reset button state
          submitButton.textContent = originalButtonText;
          submitButton.disabled = false;
        }
      });
    }
    
    // Function to save submission for offline sync
    async function saveSubmissionForOfflineSync(submissionData, file, submitButton, originalButtonText) {
      try {
        // Save to IndexedDB
        await window.dbHelper.saveSubmissionForSync(submissionData, file);
        
        // Register for background sync
        const syncRegistered = await window.dbHelper.registerBackgroundSync('sync-submissions');
        
        console.log('Submission saved for background sync, registration success:', syncRegistered);
        showNotification('You\'re offline. Your submission will be uploaded when you\'re back online.', 'info');
        
        // Reset form
        resetSubmissionForm();
      } catch (error) {
        console.error('Failed to save submission for offline sync:', error);
        showNotification('Failed to save your submission for later. Please try again when online.', 'error');
      } finally {
        // Reset button state
        submitButton.textContent = originalButtonText;
        submitButton.disabled = false;
      }
    }
    
    // Helper function to reset submission form
    function resetSubmissionForm() {
      document.getElementById('competition-select').value = '';
      document.getElementById('submission-title').value = '';
      document.getElementById('submission-description').value = '';
      document.getElementById('submission-file').value = '';
    }
    
    // Show notification
    function showNotification(message, type = 'success') {
      // Get or create notification container
      let container = document.getElementById('notification-container');
      if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.style.position = 'fixed';
        container.style.bottom = '20px';
        container.style.right = '20px';
        container.style.zIndex = '1000';
        document.body.appendChild(container);
      }
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      // Create close button
      const closeBtn = document.createElement('span');
      closeBtn.innerHTML = '&times;';
      closeBtn.style.position = 'absolute';
      closeBtn.style.right = '10px';
      closeBtn.style.top = '10px';
      closeBtn.style.cursor = 'pointer';
      closeBtn.style.fontSize = '16px';
      closeBtn.style.opacity = '0.7';
      closeBtn.style.transition = 'opacity 0.2s';
      
      closeBtn.addEventListener('mouseover', () => {
        closeBtn.style.opacity = '1';
      });
      
      closeBtn.addEventListener('mouseout', () => {
        closeBtn.style.opacity = '0.7';
      });
      
      closeBtn.addEventListener('click', () => {
        // Add slide-out animation before removing
        notification.style.animation = 'slide-out 0.3s forwards';
        setTimeout(() => {
          if (container.contains(notification)) {
            container.removeChild(notification);
          }
        }, 300);
      });
      
      // Create icon based on type
      let icon = '';
      switch(type) {
        case 'success':
          icon = '‚úì';
          break;
        case 'error':
          icon = '‚úó';
          break;
        case 'info':
          icon = '‚Ñπ';
          break;
        case 'warning':
          icon = '‚ö†';
          break;
        default:
          icon = '‚úì';
      }
      
      const iconSpan = document.createElement('span');
      iconSpan.textContent = icon;
      iconSpan.style.marginRight = '10px';
      iconSpan.style.fontWeight = 'bold';
      
      // Create message span
      const messageSpan = document.createElement('span');
      messageSpan.textContent = message;
      
      // Assemble notification
      notification.appendChild(iconSpan);
      notification.appendChild(messageSpan);
      notification.appendChild(closeBtn);
      
      // Add to container
      container.appendChild(notification);
      
      // Show notification
      setTimeout(() => {
        notification.style.display = 'block';
      }, 100);
      
      // Increment notification count for badge if relevant
      if (['success', 'info', 'warning'].includes(type) && type !== 'error') {
        if (typeof updateAppBadge === 'function') {
          updateAppBadge(1);
        }
      }
      
      // Auto-hide after a delay
      setTimeout(() => {
        // Only remove if it hasn't been manually closed
        if (container.contains(notification)) {
          notification.style.animation = 'slide-out 0.3s forwards';
          setTimeout(() => {
            if (container.contains(notification)) {
              container.removeChild(notification);
            }
          }, 300);
        }
      }, 5000);
    }
    
    // Social sharing function
    function shareContent(platform, title, text, url) {
      // If Web Share API is available and the platform is 'native'
      if (navigator.share && platform === 'native') {
        navigator.share({
          title: title,
          text: text,
          url: url || window.location.href
        })
        .then(() => {
          console.log('Successfully shared');
          showNotification('Successfully shared!');
        })
        .catch((error) => {
          console.error('Error sharing:', error);
          showNotification('Could not share content', 'error');
          // Fallback to copy to clipboard
          copyToClipboard(url || window.location.href);
        });
        return;
      }
      
      // Platform specific sharing
      let shareUrl;
      
      switch(platform) {
        case 'twitter':
          shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url || window.location.href)}`;
          break;
        case 'facebook':
          shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url || window.location.href)}`;
          break;
        case 'linkedin':
          shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url || window.location.href)}`;
          break;
        case 'email':
          shareUrl = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(text + '\n\n' + (url || window.location.href))}`;
          break;
        case 'clipboard':
          copyToClipboard(url || window.location.href);
          return;
        default:
          showNotification('Sharing not available for this platform', 'error');
          return;
      }
      
      // Open a popup window for sharing (except for email)
      if (platform !== 'email') {
        window.open(shareUrl, '_blank', 'width=600,height=400');
      } else {
        window.location.href = shareUrl;
      }
      
      showNotification('Content shared successfully!');
    }
    
    // Helper function to copy URL to clipboard
    function copyToClipboard(text) {
      // Create temporary input
      const input = document.createElement('input');
      input.style.position = 'fixed';
      input.style.opacity = 0;
      input.value = text;
      document.body.appendChild(input);
      input.select();
      
      // Copy and clean up
      try {
        document.execCommand('copy');
        showNotification('Link copied to clipboard!');
      } catch (err) {
        console.error('Could not copy text: ', err);
        showNotification('Failed to copy link', 'error');
      }
      
      document.body.removeChild(input);
    }
    
    // Show competition details
    function showCompetitionDetails(competitionId) {
      console.log('Showing details for competition:', competitionId);
      
      try {
        // Show loading message
        document.querySelectorAll('.screen').forEach(screen => {
          screen.style.display = 'none';
        });
        
        const detailsScreen = document.getElementById('competition-details-screen');
        detailsScreen.style.display = 'block';
        detailsScreen.innerHTML = '<div class="container"><div class="card">Loading competition details...</div></div>';
        
        // Update header to show a back button
        document.getElementById('main-header').innerHTML = `
          <button class="back-button" onclick="showScreen('competitions')">
            <span class="back-icon">‚Üê</span> Back
          </button>
          <h1>Competition Details</h1>
        `;
        
        // Get the competition details from our API
        fetch(`/api/competitions/${competitionId}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('Failed to fetch competition details');
            }
            return response.json();
          })
          .then(competition => {
            // Format deadline date if available
            let deadline = 'Coming soon';
            if (competition.deadline) {
              try {
                const deadlineDate = new Date(competition.deadline);
                deadline = deadlineDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
              } catch (e) {
                console.error('Error formatting date:', e);
                deadline = competition.deadline;
              }
            }
            
            // Create competition details HTML
            detailsScreen.innerHTML = `
              <div class="container">
                <div class="card">
                  <div class="competition-header">
                    <h2 id="competition-title">${competition.title}</h2>
                    <div class="competition-meta">
                      <div class="meta-item"><strong>Deadline:</strong> <span id="competition-deadline">${deadline}</span></div>
                      <div class="meta-item"><strong>Entries:</strong> <span id="competition-entries">0</span></div>
                    </div>
                    <div id="competition-categories">
                      <span class="badge primary">${competition.category || 'General'}</span>
                    </div>
                  </div>
                  
                  <div id="competition-description">
                    <p>${competition.description}</p>
                  </div>
                  
                  <h3>Prizes</h3>
                  <ul id="competition-prizes">
                    <li>${competition.prize || 'Prizes to be announced'}</li>
                  </ul>
                  
                  <h3>Rules</h3>
                  <ul id="competition-rules">
                    <li>All submissions must be original work</li>
                    <li>One submission per participant</li>
                  </ul>
                  
                  <h3>Share This Competition</h3>
                  <div class="share-buttons">
                    <button class="share-button twitter" title="Share on Twitter" onclick="shareContent('twitter', '${competition.title}', 'Check out this creative competition: ${competition.title}')">
                      T
                    </button>
                    <button class="share-button facebook" title="Share on Facebook" onclick="shareContent('facebook', '${competition.title}', 'Join this creative competition')">
                      f
                    </button>
                    <button class="share-button linkedin" title="Share on LinkedIn" onclick="shareContent('linkedin', '${competition.title}', 'Participate in ${competition.title}')">
                      in
                    </button>
                    <button class="share-button email" title="Share via Email" onclick="shareContent('email', '${competition.title}', 'I thought you might be interested in this competition: ${competition.title}')">
                      ‚úâ
                    </button>
                    <button class="share-button clipboard" title="Copy Link" onclick="shareContent('clipboard', '${competition.title}', 'Check out this competition')">
                      üìã
                    </button>
                  </div>
                  
                  <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="showScreen('submit'); document.getElementById('competition-select').value = '${competition.id}';">Submit Entry</button>
                    <button onclick="showScreen('competitions')" class="secondary">Back to List</button>
                  </div>
                </div>
                
                <div class="card">
                  <h3>Top Submissions</h3>
                  <div id="submissions-list">
                    <p class="loading">Loading submissions...</p>
                  </div>
                </div>
              </div>
            `;
            
            // Load submissions for this competition
            loadCompetitionSubmissions(competitionId);
          })
          .catch(error => {
            console.error('Error loading competition details:', error);
            detailsScreen.innerHTML = `
              <div class="container">
                <div class="card">
                  <h2>Error</h2>
                  <p>Error loading competition details: ${error.message}</p>
                  <button onclick="showScreen('competitions')" class="secondary">Back to Competitions</button>
                </div>
              </div>
            `;
          });
      } catch (error) {
        console.error('Error in showCompetitionDetails function:', error);
        showNotification('An unexpected error occurred', 'error');
        showScreen('competitions');
      }
    }
    
    // Load competitions from API
    // Load competition submissions and enable voting
    function loadCompetitionSubmissions(competitionId) {
      console.log('Loading submissions for competition:', competitionId);
      const submissionsList = document.getElementById('submissions-list');
      
      if (!submissionsList) {
        console.error('Submissions list element not found');
        return;
      }
      
      submissionsList.innerHTML = '<p class="loading">Loading submissions...</p>';
      
      fetch(`/api/competitions/${competitionId}/submissions`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch submissions');
          }
          return response.json();
        })
        .then(submissions => {
          console.log('Submissions loaded:', submissions);
          
          if (!submissions || submissions.length === 0) {
            submissionsList.innerHTML = '<p>No submissions yet. Be the first to enter!</p>';
            return;
          }
          
          // Clear loading message
          submissionsList.innerHTML = '';
          
          // Sort submissions by votes (highest first)
          submissions.sort((a, b) => (b.votes || 0) - (a.votes || 0));
          
          // Add each submission with voting button
          submissions.forEach(submission => {
            const submissionElement = document.createElement('div');
            submissionElement.className = 'submission-item';
            
            // Format creation date if available
            let createdDate = 'Recently';
            if (submission.created_at) {
              try {
                const date = new Date(submission.created_at);
                createdDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
              } catch (e) {
                console.error('Error formatting submission date:', e);
              }
            }
            
            submissionElement.innerHTML = `
              <div class="submission-header">
                <h4>${submission.title}</h4>
                <span class="submission-date">Submitted: ${createdDate}</span>
              </div>
              <p>${submission.description}</p>
              <div class="submission-footer">
                <div class="votes-container">
                  <span class="votes-count" id="votes-${submission.id}">${submission.votes || 0}</span>
                  <span class="votes-label">votes</span>
                </div>
                <button class="vote-button" onclick="voteForSubmission('${submission.id}')">
                  <span class="vote-icon">üëç</span> Vote
                </button>
              </div>
            `;
            
            submissionsList.appendChild(submissionElement);
          });
        })
        .catch(error => {
          console.error('Error loading submissions:', error);
          submissionsList.innerHTML = `<p>Error loading submissions: ${error.message}</p>`;
        });
    }
    
    // Vote for a submission
    function voteForSubmission(submissionId) {
      console.log('Voting for submission:', submissionId);
      
      // Disable all vote buttons to prevent multiple votes
      const voteButtons = document.querySelectorAll('.vote-button');
      voteButtons.forEach(button => {
        button.disabled = true;
        button.classList.add('disabled');
      });
      
      // Check if we're online
      if (navigator.onLine) {
        // We're online - send vote to API
        sendVoteToServer(submissionId);
      } else {
        // We're offline - save vote for later sync
        saveVoteForOfflineSync(submissionId);
      }
    }
    
    // Function to send vote to server
    function sendVoteToServer(submissionId) {
      fetch('/api/vote', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ submissionId })
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to record vote');
          }
          return response.json();
        })
        .then(data => {
          console.log('Vote recorded successfully:', data);
          updateVoteUI(submissionId, data.votes);
        })
        .catch(error => {
          console.error('Error recording vote:', error);
          // If there's a network error, save for offline sync
          if (!navigator.onLine || error.message.includes('network')) {
            saveVoteForOfflineSync(submissionId);
          } else {
            showNotification('Failed to record vote: ' + error.message, 'error');
          }
        });
    }
    
    // Function to save vote for offline sync
    async function saveVoteForOfflineSync(submissionId) {
      try {
        // Create vote object
        const vote = { 
          submissionId: submissionId,
          timestamp: new Date().toISOString()
        };
        
        // Save to IndexedDB
        await window.dbHelper.saveVoteForSync(vote);
        
        // Register for background sync
        const syncRegistered = await window.dbHelper.registerBackgroundSync('sync-votes');
        
        // Update UI with optimistic update
        updateVoteUI(submissionId, null, true);
        
        // Show notification
        showNotification('You\'re offline. Your vote will be submitted when you\'re back online.', 'info');
        console.log('Vote saved for background sync, registration success:', syncRegistered);
      } catch (error) {
        console.error('Failed to save vote for offline sync:', error);
        showNotification('Failed to save your vote for later. Please try again when online.', 'error');
      }
    }
    
    // Update vote UI after voting
    function updateVoteUI(submissionId, votes, isOffline = false) {
      const votesElement = document.getElementById(`votes-${submissionId}`);
      if (votesElement) {
        if (votes !== null) {
          // If we have votes count from the server
          votesElement.textContent = votes;
        } else if (isOffline) {
          // If offline, increment locally by 1
          const currentVotes = parseInt(votesElement.textContent || '0', 10);
          votesElement.textContent = currentVotes + 1;
        }
        
        // Add animation class for visual feedback
        votesElement.classList.add('vote-added');
        setTimeout(() => {
          votesElement.classList.remove('vote-added');
        }, 1000);
      }
      
      // Show success notification
      showNotification('Your vote has been recorded!', 'success');
      
      // Re-enable the vote buttons after a delay
      setTimeout(() => {
        const voteButtons = document.querySelectorAll('.vote-button');
        voteButtons.forEach(button => {
          button.disabled = false;
          button.classList.remove('disabled');
        });
      }, 1000);
    }
    
    function loadCompetitions() {
      const competitionsList = document.getElementById('competitions-list');
      const loadingHTML = '<div class="card"><p>Loading competitions...</p></div>';
      competitionsList.innerHTML = loadingHTML;
      
      fetch('/api/competitions')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch competitions');
          }
          return response.json();
        })
        .then(competitions => {
          console.log('Competitions loaded:', competitions);
          
          if (competitions && competitions.length > 0) {
            // Clear loading message
            competitionsList.innerHTML = '';
            
            // Update competition select dropdown
            const competitionSelect = document.getElementById('competition-select');
            competitionSelect.innerHTML = '<option value="">-- Select a competition --</option>';
            
            // Add each competition
            competitions.forEach(competition => {
              // Create competition card
              const card = document.createElement('div');
              card.className = 'card';
              
              // Format deadline date if available
              let deadline = 'Coming soon';
              if (competition.deadline) {
                try {
                  const deadlineDate = new Date(competition.deadline);
                  deadline = deadlineDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                } catch (e) {
                  console.error('Error formatting date:', e);
                  deadline = competition.deadline;
                }
              }
              
              // Set HTML content for the card
              card.innerHTML = `
                <h3>${competition.title}</h3>
                <div class="competition-meta">
                  <div class="meta-item"><strong>Ends:</strong> ${deadline}</div>
                  <div class="meta-item"><strong>Prize:</strong> ${competition.prize || 'Various prizes'}</div>
                </div>
                <p>${competition.description}</p>
                <div>
                  <span class="badge primary">${competition.category || 'General'}</span>
                  <span class="badge success">${competition.status || 'Active'}</span>
                </div>
                <div style="margin-top: 15px;">
                  <button onclick="showCompetitionDetails('${competition.id}')">View Details</button>
                </div>
              `;
              
              competitionsList.appendChild(card);
              
              // Add to select dropdown
              const option = document.createElement('option');
              option.value = competition.id;
              option.textContent = competition.title;
              competitionSelect.appendChild(option);
            });
          } else {
            competitionsList.innerHTML = '<div class="card"><p>No active competitions found. Check back soon!</p></div>';
          }
        })
        .catch(error => {
          console.error('Error loading competitions:', error);
          competitionsList.innerHTML = `<div class="card"><p>Error loading competitions: ${error.message}</p></div>`;
        });
    }
    
    // Log when page loads
    window.addEventListener('load', function() {
      console.log('CreativeCrowdChallenge app loaded successfully!');
      
      // Load competitions on page load
      loadCompetitions();
      
      // Check for existing logged in user
      const savedUser = localStorage.getItem('user');
      if (savedUser) {
        try {
          currentUser = JSON.parse(savedUser);
          isLoggedIn = true;
          updateProfileView();
        } catch (e) {
          console.error('Error loading saved user:', e);
          localStorage.removeItem('user');
        }
      }
      
      // Initialize analytics if user visits that tab
      const analyticsTab = document.querySelector('.tab[data-screen="analytics"]');
      if (analyticsTab) {
        analyticsTab.addEventListener('click', function() {
          initializeAnalytics();
          
          // Add a little delay to ensure the screen is fully shown before rendering charts
          setTimeout(() => {
            loadBusinessAnalytics();
          }, 100);
        });
      }
    });
    
    // Business Analytics Functions
    let competitionsChart;
    let demographicsChart;
    let timelineChart;
    let analyticsData = null;
    
    // Helper function to reset canvas for chart reuse
    function resetCanvasElement(canvasId) {
      const container = document.getElementById(canvasId);
      if (!container) {
        console.error(`Container element not found: ${canvasId}`);
        return;
      }
      
      // Clear the container completely
      container.innerHTML = '';
      
      // Create a fresh canvas element
      const canvas = document.createElement('canvas');
      canvas.id = `${canvasId}-canvas`;
      canvas.style.width = '100%';
      canvas.style.height = '100%';
      container.appendChild(canvas);
      
      console.log(`Reset canvas for ${canvasId}`);
      return canvas;
    }
    
    function initializeAnalytics() {
      console.log('Initializing analytics dashboard');
      
      // Set up event listeners for business selector and export buttons
      const businessSelector = document.getElementById('business-selector');
      if (businessSelector) {
        businessSelector.addEventListener('change', loadBusinessAnalytics);
        // Load initial data after a short delay to ensure DOM is fully ready
        setTimeout(() => {
          // Load default business analytics
          loadBusinessAnalytics();
        }, 100);
      }
      
      // Connect export buttons
      const exportButtons = document.querySelectorAll('.export-button');
      exportButtons.forEach(button => {
        button.addEventListener('click', function() {
          const format = this.getAttribute('data-format');
          exportAnalytics(format);
        });
      });
    }
    
    // Show Analytics Dashboard from back office
    function showAnalyticsDashboard() {
      console.log('Opening Analytics Dashboard from back office');
      showScreen('analytics-screen');
      
      // Add a back button in the header when coming from profile
      document.getElementById('main-header').innerHTML = `
        <button class="back-button" onclick="showScreen('profile')">
          <span class="back-icon">‚Üê</span> Back to Profile
        </button>
        <h1>Analytics Dashboard</h1>
      `;
      
      // Initialize analytics dashboard
      setTimeout(() => {
        initializeAnalytics();
      }, 100);
    }
    
    function loadBusinessAnalytics() {
      const businessId = document.getElementById('business-selector').value;
      
      // Clear existing charts if they exist
      if (competitionsChart) {
        competitionsChart.destroy();
        competitionsChart = null;
      }
      if (demographicsChart) {
        demographicsChart.destroy();
        demographicsChart = null;
      }
      if (timelineChart) {
        timelineChart.destroy();
        timelineChart = null;
      }
      
      // Show loading state and prepare chart containers
      document.getElementById('competitions-chart').innerHTML = '<div class="loading">Loading chart data...</div>';
      document.getElementById('demographics-chart').innerHTML = '<div class="loading">Loading chart data...</div>';
      document.getElementById('timeline-chart').innerHTML = '<div class="loading">Loading chart data...</div>';
      
      console.log(`Loading analytics data for business ID: ${businessId}`);
      
      // Call our API
      fetch(`/api/analytics/business/${businessId}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load analytics data');
          }
          return response.json();
        })
        .then(data => {
          analyticsData = data;
          displayAnalyticsData(data);
        })
        .catch(error => {
          console.error('Error loading analytics data:', error);
          showNotification('Failed to load analytics data. Using sample data.', 'error');
          
          // Load mock data if API fails
          analyticsData = getMockAnalyticsData(businessId);
          displayAnalyticsData(analyticsData);
        });
    }
    
    function displayAnalyticsData(data) {
      // Update summary stats
      document.getElementById('total-competitions').textContent = data.totalCompetitions;
      document.getElementById('total-submissions').textContent = data.totalSubmissions;
      document.getElementById('total-views').textContent = data.totalViews;
      document.getElementById('avg-engagement').textContent = data.avgEngagement;
      
      // Update analytics table
      const tableBody = document.getElementById('analytics-table-body');
      tableBody.innerHTML = '';
      
      data.competitions.forEach(comp => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${comp.title}</td>
          <td>${comp.submissions}</td>
          <td>${comp.views}</td>
          <td>${comp.engagementRate}</td>
        `;
        tableBody.appendChild(row);
      });
      
      // Prepare canvas elements for the charts
      const competitionsCanvas = resetCanvasElement('competitions-chart');
      const demographicsCanvas = resetCanvasElement('demographics-chart');
      const timelineCanvas = resetCanvasElement('timeline-chart');
      
      // Create/update charts
      if (competitionsCanvas) createCompetitionsChart(data.competitions);
      if (demographicsCanvas) createDemographicsChart(data.demographics);
      if (timelineCanvas) createTimelineChart(data.timeline);
    }
    
    function createCompetitionsChart(competitions) {
      console.log('Starting competitions chart creation');
      
      // Get canvas element
      const canvas = document.getElementById('competitions-chart-canvas');
      console.log('Looking for canvas with ID:', 'competitions-chart-canvas');
      console.log('Canvas found:', Boolean(canvas));
      
      if (!canvas) {
        console.error('Competition chart canvas not found');
        console.log('Available chart containers:', document.querySelectorAll('.chart-container').length);
        console.log('Contents of competitions-chart div:', document.getElementById('competitions-chart')?.innerHTML);
        return;
      }
      
      // Get 2D context
      const ctx = canvas.getContext('2d');
      console.log('Canvas context available:', Boolean(ctx));
      
      if (!ctx) {
        console.error('Could not get 2D context for competition chart');
        return;
      }
      
      if (competitionsChart) {
        competitionsChart.destroy();
      }
      
      console.log('Creating competitions chart with data:', competitions);
      competitionsChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: competitions.map(comp => comp.title),
          datasets: [{
            label: 'Submissions',
            data: competitions.map(comp => comp.submissions),
            backgroundColor: 'rgba(59, 130, 246, 0.6)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1
          }, {
            label: 'Views (divided by 10)',
            data: competitions.map(comp => comp.views / 10),
            backgroundColor: 'rgba(16, 185, 129, 0.6)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function createDemographicsChart(demographics) {
      // Get canvas element
      const canvas = document.getElementById('demographics-chart-canvas');
      if (!canvas) {
        console.error('Demographics chart canvas not found');
        return;
      }
      
      // Get 2D context
      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get 2D context for demographics chart');
        return;
      }
      
      if (demographicsChart) {
        demographicsChart.destroy();
      }
      
      console.log('Creating demographics chart with data:', demographics);
      demographicsChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(demographics),
          datasets: [{
            data: Object.values(demographics),
            backgroundColor: [
              'rgba(59, 130, 246, 0.6)',
              'rgba(16, 185, 129, 0.6)',
              'rgba(249, 115, 22, 0.6)',
              'rgba(236, 72, 153, 0.6)',
              'rgba(139, 92, 246, 0.6)'
            ],
            borderColor: [
              'rgba(59, 130, 246, 1)',
              'rgba(16, 185, 129, 1)',
              'rgba(249, 115, 22, 1)',
              'rgba(236, 72, 153, 1)',
              'rgba(139, 92, 246, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        }
      });
    }
    
    function createTimelineChart(timelineData) {
      // Get canvas element
      const canvas = document.getElementById('timeline-chart-canvas');
      if (!canvas) {
        console.error('Timeline chart canvas not found');
        return;
      }
      
      // Get 2D context
      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get 2D context for timeline chart');
        return;
      }
      
      if (timelineChart) {
        timelineChart.destroy();
      }
      
      console.log('Creating timeline chart with data:', timelineData);
      timelineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timelineData.dates,
          datasets: [{
            label: 'Submissions',
            data: timelineData.submissions,
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }, {
            label: 'Views',
            data: timelineData.views,
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function exportAnalytics(format) {
      if (!analyticsData) {
        showNotification('No analytics data available to export', 'error');
        return;
      }
      
      switch(format) {
        case 'csv':
          exportCSV();
          break;
        case 'pdf':
          showNotification('PDF export functionality coming soon!');
          break;
        case 'json':
          exportJSON();
          break;
        default:
          showNotification('Unknown export format', 'error');
      }
    }
    
    function exportCSV() {
      // Create CSV content
      let csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "Competition,Submissions,Views,Engagement Rate\n";
      
      analyticsData.competitions.forEach(comp => {
        csvContent += `${comp.title},${comp.submissions},${comp.views},${comp.engagementRate}\n`;
      });
      
      // Create download link
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "analytics_export.csv");
      document.body.appendChild(link);
      
      // Trigger download and cleanup
      link.click();
      document.body.removeChild(link);
      
      showNotification('Analytics exported as CSV');
    }
    
    function exportJSON() {
      // Create JSON content
      const jsonContent = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(analyticsData, null, 2));
      
      // Create download link
      const link = document.createElement("a");
      link.setAttribute("href", jsonContent);
      link.setAttribute("download", "analytics_export.json");
      document.body.appendChild(link);
      
      // Trigger download and cleanup
      link.click();
      document.body.removeChild(link);
      
      showNotification('Analytics exported as JSON');
    }
    
    function getMockAnalyticsData(businessId) {
      // Mock data for business analytics
      if (businessId === 'mock-business-1') {
        return {
          totalCompetitions: 3,
          totalSubmissions: 42,
          totalViews: '1.2k',
          avgEngagement: '32%',
          competitions: [
            { title: 'Logo Design Challenge', submissions: 24, views: 487, engagementRate: '4.9%' },
            { title: 'Marketing Campaign Concept', submissions: 18, views: 378, engagementRate: '4.8%' }
          ],
          demographics: {
            '18-24': 25,
            '25-34': 42,
            '35-44': 18,
            '45-54': 10,
            '55+': 5
          },
          timeline: {
            dates: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            submissions: [5, 12, 18, 23, 29, 42],
            views: [120, 250, 380, 470, 580, 720]
          }
        };
      } else {
        return {
          totalCompetitions: 1,
          totalSubmissions: 12,
          totalViews: '295',
          avgEngagement: '24%',
          competitions: [
            { title: 'Mobile App UI Challenge', submissions: 12, views: 295, engagementRate: '4.1%' }
          ],
          demographics: {
            '18-24': 32,
            '25-34': 38,
            '35-44': 15,
            '45-54': 10,
            '55+': 5
          },
          timeline: {
            dates: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            submissions: [0, 0, 4, 7, 10, 12],
            views: [0, 0, 90, 152, 217, 295]
          }
        };
      }
    }
    
    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    });
    
    // PWA Service Worker Registration and Offline Detection
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        // Check initial online status and update UI
        updateOnlineStatus();
        
        // Add event listeners for online/offline status changes
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        navigator.serviceWorker.register('/service-worker.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
            
            // Listen for messages from service worker (e.g., sync completed)
            navigator.serviceWorker.addEventListener('message', function(event) {
              console.log('Received message from service worker:', event.data);
              
              // Handle background sync completed messages
              if (event.data.type === 'SYNC_COMPLETED') {
                const { type, count } = event.data.data;
                
                if (type === 'votes') {
                  showNotification(`${count} vote(s) successfully synchronized!`, 'success');
                } else if (type === 'submissions') {
                  showNotification(`${count} submission(s) successfully uploaded!`, 'success');
                }
              }
              
              // Handle badge count updates from service worker
              if (event.data.type === 'BADGE_COUNT_UPDATED') {
                const count = event.data.data.count;
                console.log('Received badge count update:', count);
                updateAppBadge(count);
              }
            });
            
            // Push notification setup
            setupPushNotifications(registration);
            
            // Add install prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
              // Prevent Chrome 67 and earlier from automatically showing the prompt
              e.preventDefault();
              // Stash the event so it can be triggered later
              deferredPrompt = e;
              
              // Show the install prompt if not already installed
              setTimeout(() => {
                // Check if we should show install prompt (not already added to home screen)
                if (deferredPrompt) {
                  // Show the install prompt banner
                  const installPrompt = document.getElementById('install-prompt');
                  if (installPrompt) {
                    installPrompt.style.display = 'block';
                    
                    // Add event listener to install button
                    const installButton = document.getElementById('install-button');
                    if (installButton) {
                      installButton.addEventListener('click', () => {
                        // Hide the prompt
                        installPrompt.style.display = 'none';
                        
                        // Show the browser install prompt
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                          if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                            // Maybe show a thank you message
                            showNotification('App installed successfully!', 'success');
                          } else {
                            console.log('User dismissed the install prompt');
                          }
                          deferredPrompt = null;
                        });
                      });
                    }
                    
                    // Add event listener to dismiss button
                    const dismissButton = document.getElementById('dismiss-install');
                    if (dismissButton) {
                      dismissButton.addEventListener('click', () => {
                        installPrompt.style.display = 'none';
                        // Save in localStorage to not show again for some time
                        localStorage.setItem('installPromptDismissed', Date.now().toString());
                      });
                    }
                  }
                }
              }, 3000);
            });
          })
          .catch(function(error) {
            console.log('ServiceWorker registration failed: ', error);
          });
      });
    }
    
    // Push Notification Setup
    function setupPushNotifications(swRegistration) {
      // Check if push notifications are supported
      if (!('PushManager' in window)) {
        console.log('Push notifications not supported');
        return;
      }
      
      // Add notification button to profile section
      const profileSection = document.querySelector('#profile-screen .container');
      if (profileSection) {
        const notificationSection = document.createElement('div');
        notificationSection.className = 'card';
        notificationSection.innerHTML = `
          <h3>Notifications</h3>
          <p>Get notified about new competitions, updates, and results.</p>
          <button id="notification-permission-btn" class="primary">Enable Notifications</button>
        `;
        profileSection.appendChild(notificationSection);
        
        // Add event listener to notification permission button
        const notificationBtn = document.getElementById('notification-permission-btn');
        notificationBtn.addEventListener('click', () => {
          requestNotificationPermission(swRegistration);
        });
        
        // Update button text based on current permission
        updateNotificationButtonState(notificationBtn);
      }
    }
    
    // Request notification permission
    function requestNotificationPermission(swRegistration) {
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          console.log('Notification permission granted');
          showNotification('Notifications enabled!', 'success');
          
          // Subscribe to push notifications
          subscribeToPushNotifications(swRegistration);
          
          // Update notification button
          const notificationBtn = document.getElementById('notification-permission-btn');
          if (notificationBtn) {
            updateNotificationButtonState(notificationBtn);
          }
          
          // Send test notification after a short delay
          setTimeout(() => {
            showPushNotification('Welcome to CreativeCrowdChallenge!', {
              body: 'You will now receive updates about new competitions and events.',
              icon: '/assets/icon-192x192.png',
              badge: '/assets/icon-192x192.png'
            });
          }, 2000);
        } else {
          console.log('Notification permission denied');
          showNotification('Notification permission denied', 'error');
        }
      });
    }
    
    // Update notification button state
    function updateNotificationButtonState(button) {
      if (Notification.permission === 'granted') {
        button.textContent = 'Notifications Enabled';
        button.disabled = true;
        button.classList.add('success');
      } else {
        button.textContent = 'Enable Notifications';
        button.disabled = false;
        button.classList.remove('success');
      }
    }
    
    // Subscribe to push notifications
    function subscribeToPushNotifications(swRegistration) {
      // This would typically create a subscription and send to server
      // For demo purposes, we'll just log it
      console.log('Would subscribe to push notifications here');
      
      // In a real app, you would use:
      /*
      swRegistration.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: urlBase64ToUint8Array('your-public-key')
      })
      .then(subscription => {
        // Send subscription to your server
        console.log('User subscribed:', subscription);
      })
      */
    }
    
    // Show push notification
    function showPushNotification(title, options) {
      if (Notification.permission === 'granted') {
        navigator.serviceWorker.ready.then(registration => {
          registration.showNotification(title, options);
        });
      }
    }
    
    // Update app badge (if supported)
    function updateAppBadge(count) {
      if ('setAppBadge' in navigator) {
        if (count > 0) {
          navigator.setAppBadge(count).catch(error => {
            console.error('Error setting app badge:', error);
          });
        } else {
          navigator.clearAppBadge().catch(error => {
            console.error('Error clearing app badge:', error);
          });
        }
      } else {
        console.log('App Badge API not supported in this browser');
      }
    }
    
    // Function to check online status and update the UI
    function updateOnlineStatus() {
      const offlineNotification = document.getElementById('offline-notification');
      
      if (navigator.onLine) {
        // User is online
        offlineNotification.style.display = 'none';
        console.log('Application is online');
      } else {
        // User is offline
        offlineNotification.style.display = 'block';
        console.log('Application is offline');
      }
    }
  </script>
</body>
</html>